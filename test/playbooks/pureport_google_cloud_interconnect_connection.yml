---
- hosts: localhost
  tasks:
    - name: Test create Non-HA GCI connection
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        wait_for_server: true
        name: "Test Google Cloud Interconnect"
        speed: 50
        location: "{{ location }}"
        billing_term: HOURLY
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        customer_networks:
          - address: 192.167.1.1/32
            name: My Custom Address
      register: result
    - debug: var=result
    - fail:
      when: result.changed != true

    - name: Test update Non-HA GCI connection (no changes)
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        wait_for_server: true
        id: "{{ result.connection.id }}"
        name: "{{ result.connection.name }}"
        speed: "{{ result.connection.speed }}"
        high_availability: "{{ result.connection.highAvailability }}"
        location: "{{ location }}"
        billing_term: "{{ result.connection.billingTerm }}"
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        customer_networks: "{{ result.connection.customerNetworks }}"
      register: result
    - debug: var=result
    - fail:
      when: result.changed == true

    - name: Test update Non-HA GCI connection (changes)
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        wait_for_server: true
        id: "{{ result.connection.id }}"
        name: "{{ result.connection.name }}"
        speed: "{{ result.connection.speed }}"
        high_availability: "{{ result.connection.highAvailability }}"
        location: "{{ location }}"
        billing_term: "{{ result.connection.billingTerm }}"
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        customer_networks:
          - address: 192.167.1.2/32
            name: My Custom Address
      register: result
    - debug: var=result
    - fail:
      when: result.changed != true

    - name: Test delete Non-HA GCI connection
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        state: 'absent'
        wait_for_server: true
        id: "{{ result.connection.id }}"
        name: "{{ result.connection.name }}"
        speed: "{{ result.connection.speed }}"
        high_availability: "{{ result.connection.highAvailability }}"
        location: "{{ location }}"
        billing_term: "{{ result.connection.billingTerm }}"
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        customer_networks: "{{ result.connection.customerNetworks }}"
      register: result
    - debug: var=result
    - fail:
      when: result.changed != true

    - name: Test create HA GCI connection
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        wait_for_server: true
        name: "Test Google Cloud Interconnect"
        speed: 50
        high_availability: true
        location: "{{ location }}"
        billing_term: HOURLY
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        secondary_pairing_key: "{{ gci_secondary_pairing_key }}"
        customer_networks:
          - address: 192.167.1.1/32
            name: My Custom Address
      register: result
    - debug: var=result
    - fail:
      when: result.changed != true

    - name: Test update Non-HA GCI connection (no changes)
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        wait_for_server: true
        id: "{{ result.connection.id }}"
        name: "{{ result.connection.name }}"
        speed: "{{ result.connection.speed }}"
        high_availability: "{{ result.connection.highAvailability }}"
        location: "{{ location }}"
        billing_term: "{{ result.connection.billingTerm }}"
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        secondary_pairing_key: "{{ gci_secondary_pairing_key }}"
        customer_networks: "{{ result.connection.customerNetworks }}"
      register: result
    - debug: var=result
    - fail:
      when: result.changed == true

    - name: Test update Non-HA GCI connection (changes)
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        wait_for_server: true
        id: "{{ result.connection.id }}"
        name: "{{ result.connection.name }}"
        speed: "{{ result.connection.speed }}"
        high_availability: "{{ result.connection.highAvailability }}"
        location: "{{ location }}"
        billing_term: "{{ result.connection.billingTerm }}"
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        secondary_pairing_key: "{{ gci_secondary_pairing_key }}"
        customer_networks:
          - address: 192.167.1.2/32
            name: My Custom Address
      register: result
    - debug: var=result
    - fail:
      when: result.changed != true

    - name: Test delete Non-HA GCI connection
      pureport_google_cloud_interconnect_connection:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
        state: 'absent'
        wait_for_server: true
        id: "{{ result.connection.id }}"
        name: "{{ result.connection.name }}"
        speed: "{{ result.connection.speed }}"
        high_availability: "{{ result.connection.highAvailability }}"
        location: "{{ location }}"
        billing_term: "{{ result.connection.billingTerm }}"
        primary_pairing_key: "{{ gci_primary_pairing_key }}"
        secondary_pairing_key: "{{ gci_secondary_pairing_key }}"
        customer_networks: "{{ result.connection.customerNetworks }}"
      register: result
    - debug: var=result
    - fail:
      when: result.changed != true