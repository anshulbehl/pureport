---
- hosts: all
  tasks:
    - name: Test works with an account
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        account: "{{ account }}"
      register: result
    - debug: var=result

    - name: Test works with an account id
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        account_id: "{{ account_id }}"
      register: result
    - debug: var=result

    - name: Test that my module fails when passing both account & account_id
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        account: "{{ account }}"
        account_id: "{{ account_id }}"
      register: result
      ignore_errors: yes
    - debug: var=result

    - name: Test works with an network
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network: "{{ network }}"
      register: result
    - debug: var=result

    - name: Test works with an network id
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network_id: "{{ network_id }}"
      register: result
    - debug: var=result

    - name: Test that my module fails when passing both network & network_id
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        network: "{{ network }}"
        network_id: "{{ network_id }}"
      register: result
      ignore_errors: yes
    - debug: var=result

    - name: Test that my module fails when passing both account & network_id
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        account: "{{ account }}"
        network_id: "{{ network_id }}"
      register: result
      ignore_errors: yes
    - debug: var=result

    - name: Test that my module fails when passing none of account, account_id, network, network_id
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
      register: result
      ignore_errors: yes
    - debug: var=result

    - name: Test that a filter works for the connections
      pureport_connection_facts:
        api_base_url: "{{ api_base_url }}"
        api_key: "{{ api_key }}"
        api_secret: "{{ api_secret }}"
        account: "{{ account }}"
      register: result
    - name: Display all connection ids
      debug:
        var: item
      loop: "{{ result.connections | json_query('[*].id') }}"
